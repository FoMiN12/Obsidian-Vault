## Простые утилиты
Логирование всех комманд:
Debug traps!
```bash 
#!/bin/sh

__dump()
{
	echo "$USER($UID:$GROUPS)run$BASH_COMMAN">>/tmp/cyberhackers.log
}

trap __dump DEBUG
```
---
```bash
hack@cyberhackers> echo "$THIS" >>/etc/profiles
```
### Отслеживание изменений
##### Утилита Script
```bash
hack@cyberhackers> script -B sessions.data -T time.data
hack@cyberhackers> exit
hack@cyberhackers> sriptplay -B sessions.data -T time.data
```
Проблема: 
- слишком много данных

##### Утилита Screen
```bash
hack@cyberhackers> screen -L -Logfile sessions.log
hack@cyberhackers> exit
hack@cyberhackers> tac sessions.log
```
Проблема: 
- нет шифрования
Плюсы: 
- Отправка данных на удаленный сервер

### Выводы:
Логирование необходимо
## Сложные утилиты
##### Утилита Sudo
```bash
hack@cyberhackers> cat /etc/sudoers.d/cyberhackers
cyberhackers ALL=(cyberhackers) LOG_INPUT:LOG_OUTPUT:NOPASSWD:ALL

hack@cyberhackers> cat /etc/passwd|grep cyberhackers
cyberhackers:x:1001:1001::/home/cyberhackers:/usr/local/bin/sudo-shell

hack@cyberhackers> cat /usr/local/bin/sudo-shell

#!/bin/sh
sudo -u $USER /bin/bash "$@"
```

Плюсы: 
- Шифрование
- Оптимизиция потребления ресурсов
- Есть скрытый ввод

Минусы:
- Нет оптимизации по памяти
- Не для начинающих
- Не для готовой инфраструктуры

##### Утилита Linux audit/SELinux
```bash
hack@cyberhackers> auditctl -a always,exit -F arch=b64 -S execve -F euid=0

hack@cyberhackers> cat /var/log/audit/audit.log|grep -P'(SYSCALL|EXECVE)'
```
Создает shadow root
Пользователь работает с копией root

Плюсы:
- Возможность полной настройки
- Отправкаа данных множеством способов
- Не "ест" диск и оперативную память

Минусы:
- Сложность настройки

Linux audit проще настроить

##### LKM drivers
Команды для загрузки драйверов:
```bash
hack@cyberhackers> insmod ./driver.ko

hack@cyberhackers> rmmod ./driver.ko
```
Использование драйверов для мониторинга

Минусы:
- Сложность внедрения
## Выводы
- Встроенные системы мониторинга нормально не работают
- Хорошие системы мониторинга требуют настройки
- Системы мониторинга очень важны для безопасности